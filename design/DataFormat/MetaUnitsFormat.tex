Meta unit file format have a particular format.
All describes fields are in bigendian format number.
This file does not contain data, it contains the list of all data file units used for a resource, the resource id, and others informations detailed below.
The first bytes of the file contain \emph{RS-META}\footnote{This is a 0 string terminated. So there are 8 characters reserved.}.
\emph{Raw file} is the concatanation of all contains of META Files of a resource.
The first META file have number 1 and offset 0.
Then start real contain.
See Figure~\ref{fig:META-FILE-FORMAT} for more detail.
The next 8 bytes are the same than 8 first.
\begin{itemize}
 \item If the bytes in range [8..15] are not the same than in range [0..7] that means file is encrypted.
The key is not store by Share Resource library.
User software must delegate a key and the library will search the meta units that unlock.
The key is a symetric key.
 \item If the bytes in range [8..15] are the same than in range [0..7] that means unit is not encrypted.
 \item The fifth 32 bits word is the number of the META file in the \emph{raw file} the number is one based\footnote{This means that first META file have number 1.}.
 \item The offset is the offset of the contain in \emph{raw file}.
\end{itemize}
\input{./Graph/DataFormat/MetaFileFormat.tex}

Data in the \emph{META unit} are serialized\footnote{That means that data can be stored with no order. As the \hyperlink{fields:header-index}{header index} is not to be sure to be in the first place.}.

The Control header word is a word that give some information of the META file.
See figure \ref{fig:control-header-word} for more detail.
\begin{figure}[htbp]
  \centering
  \begin{bytefield}{32}
    \bitheader{0,7-8,15-16,23-24,31} \\

    \bitbox{1}{\rotatebox{90}{LAST}}

    \colorbitbox{lightgray}{31}{reserved}

  \end{bytefield}
  \caption{Control header word.}
  \label{fig:control-header-word}
\end{figure}

The bits in the Control Header Word are boolean. 1 means true and 0 false.
\begin{description}
  \item [LAST] Is the last META file data. That means the SHA1 of next META file in footer is not present or equal to 0.
\end{description}

\input{./Graph/DataFormat/MetaFieldFormat.tex}

The list of fields are in table \ref{tab:field-list}.

\begin{table}[htbp]
  \begin{tabular}{l|c|c|c}
    Name & introduce version & obsolete version & last version \\
    \hline
    \hyperlink{fields:meta-version}{Meta version} & 0.1 & & \\
    \hyperlink{fields:header-index}{Header index} & 0.1 & & \\
    \hyperlink{fields:resource-id}{Resource Id} & 0.1 & & \\
    \hyperlink{fields:resource-name}{Resource Name} & 0.1 & & \\
    \hyperlink{fields:data-index}{Data index} & 0.1 & & \\
    \hyperlink{fields:data-file}{Data file} & 0.1 & & \\
    \hyperlink{fields:auth-user-index}{Authorized users index} & 0.1 & & \\
    \hyperlink{fields:auth-user}{Authorized user} & 0.1 & & \\
    \hyperlink{fields:version}{Resource version} & 0.1 & & \\
    \hyperlink{fields:parents}{Parent} & 0.1 & & \\
    \hyperlink{fields:end-of-file}{End of file} & 0.1 & & \\
  \end{tabular}
  \caption{List of fields in Meta File}
  \label{tab:field-list}
\end{table}


\hypertarget{fields:meta-version}{\subsubsection{Meta version}}
\field{Meta version}{v0.1}{Mandatory}{Meta version field is the version of the file format. For example, v0.1 means that meta file respects the 0.1 file format.}

This is the field that define the version format of meta file. This field is mandatory, and it should be the first field of file.

\begin{figure}[htbp]
  \centering
  \begin{bytefield}{32}
    \bitheader{0,7-8,15-16,23-24,31} \\

    \begin{rightwordgroup}{Size}
      % We have to do the \parbox explicitly in the next line because
      % \hyperlink typesets its argument in horizontal mode.\parbox{\width}{}
      \wordbox{1}{\centering 12}
    \end{rightwordgroup} \\
    \bitfield{0x00010001}

    \begin{rightwordgroup}{Version}
      \bitbox{16}{Main version}
      \bitbox{8}{Minor version}
      \bitbox{8}{Maintenance version}
    \end{rightwordgroup} \\
    \begin{rightwordgroup}{Number}
      \wordbox{1}{\centering Meta file number.}
    \end{rightwordgroup} \\
    \begin{rightwordgroup}{Offset}
      \wordbox{2}{\centering Start base of this field in raw Meta File}
    \end{rightwordgroup} \\


  \end{bytefield}
  \caption{META version field format.}
  \label{fig:FIELD:meta-version}
\end{figure}

The figure \ref{fig:FIELD:meta-version} describes the object.
First field is the size of object and its value is 12.
Second field is the type of object, the type of this object is: \texttt{0x00010001}.
Third field is the version of the file format.
Main version is the main version of compatible software.
Major version is the major number of compatible software.
Maintenance version is the bugfix version of a delivered version.

The values change only if file format change.
The version 0.2.1 of software can have a 0.1.0 file format version.

Ex: The software 0.4.5 have a file format version: 0.3.1.
Message is visible on figure \ref{fig:FIELD:meta-version:example}
\begin{figure}[htbp]
  \centering
  \begin{bytefield}{32}
    \bitheader{0,7-8,15-16,23-24,31} \\

    \begin{rightwordgroup}{Size}
      % We have to do the \parbox explicitly in the next line because
      % \hyperlink typesets its argument in horizontal mode.\parbox{\width}{}
      \wordbox{1}{\centering 12}
    \end{rightwordgroup} \\
    \bitfield{0x00010001}

    \begin{rightwordgroup}{Version}
      \bitbox{16}{0}
      \bitbox{8}{3}
      \bitbox{8}{1}
    \end{rightwordgroup}
  \end{bytefield}
  \caption{META version field example.}
  \label{fig:FIELD:meta-version:example}
\end{figure}

\hypertarget{fields:header-index}{\subsubsection{Header index}}
\field{Header index}{v0.1}{Optional}{Header index is used to help to get information faster than reading fields one by one}

This index is used to create an rapid acces to main informations.
This main index reference others index.
The order of informations are important.
The figure \ref{fig:FIELD:header-index} describes the format.

\begin{figure}[htbp]
  \centering
  \begin{bytefield}{32}
    \bitheader{0,7-8,15-16,23-24,31} \\

    \begin{rightwordgroup}{Size}
      % We have to do the \parbox explicitly in the next line because
      % \hyperlink typesets its argument in horizontal mode.\parbox{\width}{}
      \wordbox{1}{\centering 20}
    \end{rightwordgroup} \\
    \bitfield{0x00010002}

    \begin{rightwordgroup}{Resource Id}
      \wordbox{1}{offset of \hyperlink{fields:resource-id}{Resource Id}}
    \end{rightwordgroup}\\
    \begin{rightwordgroup}{Users index}
      \wordbox{1}{offset of \hyperlink{fields:auth-user-index}{Users index}}
    \end{rightwordgroup}\\
    \begin{rightwordgroup}{Resource Id}
      \wordbox{1}{offset of \hyperlink{fields:data-index}{Data index}}
    \end{rightwordgroup}\\
  \end{bytefield}
  \caption{META Header index field format.}
  \label{fig:FIELD:header-index}
\end{figure}


\hypertarget{fields:resource-id}{\subsubsection{Resource Id}}
\field{Resource Id}{v0.1}{Mandatory}{Resource Id is the Id of the resource. This Id is a uniq Id to get resource. By default Id is the initial Id SHA1 of initial Resource.}

Resource Id is the field used to retreive a resource.
This Id has to be uniq, and should not change during the life of the resource.
The Id is a SHA1 of the initial resource and a random number.
The random number is to help the software programer to create two resources with the same Id because he starts with an empty resource (for example).
See figure \ref{fig:FIELD:Resource-Id} for field detail.
\begin{figure}[htbp]
  \centering
  \begin{bytefield}{32}
    \bitheader{0,7-8,15-16,23-24,31} \\
    \begin{rightwordgroup}{Size}
      % We have to do the \parbox explicitly in the next line because
      % \hyperlink typesets its argument in horizontal mode.\parbox{\width}{}
      \wordbox{1}{\centering 48}
    \end{rightwordgroup} \\
    \bitfield{0x00010003}

    \begin{rightwordgroup}{SHA1}
      \SHABitboxes
     \end{rightwordgroup}\\

  \end{bytefield}

   \caption{META Resource Id field format.}
  \label{fig:FIELD:Resource-Id}

\end{figure}


\hypertarget{fields:resource-name}{\subsubsection{Resource Name}}
\field{Resource Name}{v0.1}{Optional}{The name of a resource. This name can be used to retreive a resource from its name.}

The name of a resource is used to search a resource by name.
The field structure is describe in figure \ref{fig:FIELD:Resource-name}.
\begin{figure}[htbp]
  \centering
  \begin{bytefield}{32}
    \bitheader{0,7-8,15-16,23-24,31} \\
    \begin{rightwordgroup}{Size}
      % We have to do the \parbox explicitly in the next line because
      % \hyperlink typesets its argument in horizontal mode.\parbox{\width}{}
      \wordbox{1}{\centering $\frac{length(name) - 1}{4} + 9$ }
    \end{rightwordgroup} \\
    \bitfield{0x00010004}

    \begin{rightwordgroup}{Name\\whithout\\'\textbackslash{}0'}
      \bitbox{8}{[0]}
      \bitbox{8}{[1]}
      \bitbox{16}{\dots} \\
      \skippedwords \\
      \bitbox{8}{[length-2]}
      \bitbox{8}{[length-1]}
      \colorbitbox{lightgray}{16}{Not Used}
    \end{rightwordgroup}\\

  \end{bytefield}

   \caption{META Name field format.}
  \label{fig:FIELD:Resource-name}

\end{figure}

\hypertarget{fields:data-index}{\subsubsection{Data index}}
\field{Data index}{v0.1}{Optional}{List all \hyperlink{fields:data-file}{Data files fields} use for store the resource.}

Data index field is used to access to data files fields or others data index.
The Data index is a field with 32 entries.
For each entry, we have a record containing: the offset of next target, type of target (data index or data file).
Offset is absolute position into META file.
See figure \ref{fig:FIELD:data-index} for detail of index and figure \ref{fig:FIELD:data-index-record} for entry format.
\begin{figure}[htbp]
  \centering
  \begin{bytefield}{32}
    \bitheader{0,7-8,15-16,23-24,31} \\
    \begin{rightwordgroup}{Size}
      % We have to do the \parbox explicitly in the next line because
      % \hyperlink typesets its argument in horizontal mode.\parbox{\width}{}
      \wordbox{1}{\centering 392 }
    \end{rightwordgroup} \\
    \bitfield{0x00010005}

    \begin{rightwordgroup}{Index\\ records}
      \wordbox{3}{Record[0]} \\
      \skippedwords \\
      \wordbox{3}{Record[31]}
    \end{rightwordgroup}\\

  \end{bytefield}

   \caption{META Data index.}
  \label{fig:FIELD:data-index}

\end{figure}
\begin{figure}[htbp]
  \centering
  \begin{bytefield}{32}
    \bitheader{0,7-8,15-16,23-24,31} \\
    \begin{rightwordgroup}{Control}
      % We have to do the \parbox explicitly in the next line because
      % \hyperlink typesets its argument in horizontal mode.\parbox{\width}{}
      \bitbox{1}{\rotatebox{90}{\tiny I/F}}
      \bitbox{1}{\rotatebox{90}{\tiny A/R}}
      \colorbitbox{lightgray}{30}{}
    \end{rightwordgroup} \\

    \begin{rightwordgroup}{64 bits\\ offset}
      \wordbox{2}{\centering  Offset in \emph{raw file}}
    \end{rightwordgroup}\\

  \end{bytefield}

   \caption{META Data index.}
  \label{fig:FIELD:data-index-record}

\end{figure}

The control word have some bit of configuration to interpret the Offset field:
\begin{itemize}
  \item I/F bit means Index or File:
    \begin{description}
      \item[0] Index: target is a data index;
      \item[1] File: target is a data file;
    \end{description}
  \item A/R bit means Absolute or Relative:
    \begin{description}
      \item [0] Absolute, offset has to be interpreted as offset from begining of raw meta file;
      \item [1] Relative, offset has to be interpreted as offset from the data index start field.
        In this case the offset word has to be interpreted as signed 64 integer.
    \end{description}

\end{itemize}

\hypertarget{fields:data-file}{\subsubsection{Data File}}
\field{Data file}{v0.1}{Mandatory}{This field is used to retreive the file cache of a part of the resource.}

There is one \emph{Data File} field for each date file for the resource.
The data file contain the SHA1 of the corresponding data file and the sequence number\footnote{The sequence number is 0 based.} of the data file.
\begin{figure}[htbp]
  \centering
  \begin{bytefield}{32}
    \bitheader{0,7-8,15-16,23-24,31} \\
    \begin{rightwordgroup}{Size}
      % We have to do the \parbox explicitly in the next line because
      % \hyperlink typesets its argument in horizontal mode.\parbox{\width}{}
      \wordbox{1}{\centering 52 }
    \end{rightwordgroup} \\
    \bitfield{0x00010006}

    \begin{rightwordgroup}{Data\\ reference}
      \wordbox{1}{Sequence Number} \\
      \SHABitboxes
    \end{rightwordgroup}\\

  \end{bytefield}

   \caption{META Data file.}
  \label{fig:FIELD:data-file}

\end{figure}

\hypertarget{fields:auth-user-index}{\subsubsection{Authorized users index}}
\field{Authorized users index}{v0.1}{Optional}{This index is used to store all authorized user.}

\hypertarget{fields:auth-user}{\subsubsection{Authorized user}}
\field{Authorized user}{v0.1}{Mandatory}{This field define a user. This field is encrypted only corresponding user can read the field. The key for encrypted fields is stored encrypted with the public key of user.}

\hypertarget{fields:version}{\subsubsection{Resource version}}
\field{Resource version}{v0.1}{Mandatory}{This field is used to follow changes in a resource. Detect that current version is obsolete.}

\hypertarget{fields:parents}{\subsubsection{Parent}}
\field{Parent}{v0.1}{Mandatory}{This field determines the previous version of the resource. There can be various parents in case of merge.}

\hypertarget{fields:end-of-file}{\subsubsection{End of file}}
\field{End of file}{v0.1}{Mandatory}{This field mark end of this meta file. The field format is standard, but the field is in the footer, and no in the \emph{meta data}.}